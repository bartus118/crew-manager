<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Debug - Load Configuration</title>
  <style>
    body { 
      font-family: 'Segoe UI', Arial, sans-serif; 
      padding: 20px; 
      background: #f5f5f5;
      max-width: 900px;
      margin: 0 auto;
    }
    .debug-section { 
      background: white; 
      padding: 20px; 
      margin: 10px 0; 
      border-radius: 8px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .debug-item { 
      margin: 8px 0; 
      padding: 10px; 
      border-left: 3px solid #ccc;
      font-family: monospace;
      font-size: 12px;
    }
    .debug-item.pass { border-left-color: #28a745; background: #f0f8f4; color: #155724; }
    .debug-item.fail { border-left-color: #dc3545; background: #f8f0f1; color: #721c24; }
    .debug-item.info { border-left-color: #0066cc; background: #e7f3ff; color: #004085; }
    code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; }
    h2 { color: #333; margin-top: 0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    .console-log { 
      background: #1e1e1e; 
      color: #d4d4d4; 
      padding: 15px; 
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      max-height: 300px;
      overflow-y: auto;
      margin: 10px 0;
      line-height: 1.4;
    }
    .console-line { display: block; margin: 2px 0; }
    .console-error { color: #f48771; }
    .console-warn { color: #dcdcaa; }
    .console-log-line { color: #d4d4d4; }
    button { 
      padding: 8px 15px; 
      background: #0066cc; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer;
      font-size: 13px;
      margin: 5px 0;
    }
    button:hover { background: #004a99; }
    .status-good { color: #28a745; font-weight: bold; }
    .status-bad { color: #dc3545; font-weight: bold; }
  </style>
</head>
<body>
  <h1>üîß Debug Panel - Konfiguracja ObciƒÖ≈ºenia</h1>
  
  <div class="debug-section">
    <h2>Szybka Diagnostyka</h2>
    <div class="debug-item info">
      Otw√≥rz konsolƒô przeglƒÖdarki (F12) i sprawd≈∫ nastƒôpujƒÖce elementy.
      Kliknij przyciski poni≈ºej by sprawdziƒá dostƒôpno≈õƒá funkcji.
    </div>
    
    <button onclick="testGlobals()">Sprawd≈∫ Globalne Funkcje</button>
    <button onclick="testDOM()">Sprawd≈∫ HTML Elementy</button>
    <button onclick="testSupabase()">Sprawd≈∫ Supabase</button>
    <button onclick="clearConsole()">Wyczy≈õƒá Konsolƒô</button>
  </div>

  <div class="debug-section">
    <h2>Konsola PrzeglƒÖdarki</h2>
    <div id="consoleOutput" class="console-log">
      <span class="console-log-line">Czekanie na dane...</span>
    </div>
  </div>

  <div class="debug-section">
    <h2>Informacje o Za≈Çadowaniu</h2>
    <div id="loadInfo"></div>
  </div>

  <script>
    // Capture console logs
    const logs = [];
    const originalLog = console.log;
    const originalError = console.error;
    const originalWarn = console.warn;

    function addLog(message, type = 'log') {
      logs.push({ message, type, time: new Date().toLocaleTimeString() });
      updateConsoleUI();
    }

    console.log = function(...args) {
      originalLog.apply(console, args);
      addLog(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '), 'log');
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      addLog(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '), 'error');
    };

    console.warn = function(...args) {
      originalWarn.apply(console, args);
      addLog(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '), 'warn');
    };

    function updateConsoleUI() {
      const el = document.getElementById('consoleOutput');
      el.innerHTML = logs.map((log, i) => {
        const className = log.type === 'error' ? 'console-error' : 
                         log.type === 'warn' ? 'console-warn' : 'console-log-line';
        return `<span class="console-line ${className}">[${log.time}] ${log.message}</span>`;
      }).join('');
      el.scrollTop = el.scrollHeight;
    }

    function clearConsole() {
      logs.length = 0;
      updateConsoleUI();
    }

    function testGlobals() {
      const tests = [];
      
      const funcs = [
        'renderLoadConfiguration',
        'handleUtilizationChange',
        'resetUtilizationDefaults',
        'showLoadConfig',
        'showAdminNotification'
      ];

      funcs.forEach(name => {
        if (typeof window[name] === 'function') {
          tests.push(`<div class="debug-item pass">‚úÖ ${name}() dostƒôpna</div>`);
        } else {
          tests.push(`<div class="debug-item fail">‚ùå ${name}() NIE dostƒôpna</div>`);
        }
      });

      const consts = [
        'DEFAULT_UTILIZATION',
        'UTILIZATION_LABELS',
        'UTILIZATION_ORDER'
      ];

      consts.forEach(name => {
        if (typeof window[name] !== 'undefined') {
          tests.push(`<div class="debug-item pass">‚úÖ Konstanta ${name} dostƒôpna</div>`);
        } else {
          tests.push(`<div class="debug-item fail">‚ùå Konstanta ${name} NIE dostƒôpna</div>`);
        }
      });

      document.getElementById('loadInfo').innerHTML = tests.join('');
      console.log('‚úÖ Globalne funkcje:', funcs.filter(f => typeof window[f] === 'function'));
    }

    function testDOM() {
      const tests = [];

      const elements = [
        { id: 'tabLoadConfig', name: 'TAB "Konfiguracja ObciƒÖ≈ºenia"' },
        { id: 'adminLoadConfigSection', name: 'Sekcja Load Config' },
        { id: 'loadConfigApp', name: 'Kontener loadConfigApp' }
      ];

      elements.forEach(el => {
        const elem = document.getElementById(el.id);
        if (elem) {
          tests.push(`<div class="debug-item pass">‚úÖ ${el.name} (id: ${el.id}) znaleziony</div>`);
        } else {
          tests.push(`<div class="debug-item fail">‚ùå ${el.name} (id: ${el.id}) NIE znaleziony</div>`);
        }
      });

      document.getElementById('loadInfo').innerHTML = tests.join('');
      console.log('‚úÖ Elementy DOM sprawdzone');
    }

    function testSupabase() {
      const tests = [];

      if (typeof window.supabase !== 'undefined') {
        tests.push(`<div class="debug-item pass">‚úÖ window.supabase dostƒôpny</div>`);
      } else {
        tests.push(`<div class="debug-item info">‚ÑπÔ∏è window.supabase - nie za≈Çadowany (normalnie dla offline)</div>`);
      }

      // Check if this is admin.js or if sb is defined
      console.log('window.sb:', typeof window.sb, window.sb);
      if (typeof window.sb === 'object' && window.sb !== null) {
        tests.push(`<div class="debug-item pass">‚úÖ window.sb (Supabase client) jest dostƒôpny</div>`);
      } else {
        tests.push(`<div class="debug-item info">‚ÑπÔ∏è window.sb - nie zalogowany lub nie zainicjalizowany</div>`);
      }

      if (typeof window.CONFIG !== 'undefined' && window.CONFIG.supabase) {
        tests.push(`<div class="debug-item pass">‚úÖ CONFIG.supabase dostƒôpny</div>`);
      } else {
        tests.push(`<div class="debug-item fail">‚ùå CONFIG.supabase NIE dostƒôpny</div>`);
      }

      document.getElementById('loadInfo').innerHTML = tests.join('');
      console.log('Supabase config:', window.CONFIG?.supabase);
    }

    // Initial info
    window.addEventListener('load', () => {
      document.getElementById('loadInfo').innerHTML = `
        <div class="debug-item info">
          <strong>Strona za≈Çadowana.</strong><br/>
          Kliknij przycisk poni≈ºej by uruchomiƒá testy, lub otw√≥rz konsolƒô (F12).
        </div>
      `;
      console.log('Debug panel za≈Çadowany');
      console.log('admin.js za≈Çadowany:', typeof showLoadConfig === 'function');
    });
  </script>

  <!-- Load required scripts from admin.html -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
</body>
</html>
