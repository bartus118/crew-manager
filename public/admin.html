<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Panel administratora â€” Crew Manager</title>
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/admin.css">
  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  
</head>
<body>
  <!-- ADMIN LOGIN MODAL -->
  <div id="adminLoginModal" aria-hidden="true" style="display:none;">
    <div class="auth-box" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <h3 id="authTitle">Logowanie â€” panel administratora</h3>
      <div class="desc">WprowadÅº hasÅ‚o, aby uzyskaÄ‡ dostÄ™p do panelu administracyjnego.</div>
      <input id="adminPasswordInput" type="password" placeholder="HasÅ‚o administratora" autocomplete="current-password" />
      <div class="actions">
        <button id="adminLoginCancel" class="btn ghost">Anuluj</button>
        <button id="adminLoginSubmit" class="btn">Zaloguj</button>
      </div>
      <div class="muted">Sesja waÅ¼na do zamkniÄ™cia karty przeglÄ…darki.</div>
    </div>
  </div>

  <header class="top-bar">
    <div class="brand">Panel administratora</div>

    <nav class="admin-nav" aria-label="Admin navigation">
      <ul class="nav-list">
        <li class="nav-item" data-tab="modify" id="tabModify">Modyfikacja maszyn</li>
        <li class="nav-item" data-tab="load-config" id="tabLoadConfig">âš™ï¸ Konfiguracja ObciÄ…Å¼enia</li>
        <li class="nav-item" data-tab="employees" id="tabEmployees">Pracownicy</li>
        <li class="nav-item" data-tab="managers" id="tabManagers">ğŸ‘” Kierownicy</li>
        <li class="nav-item disabled">Raporty</li>
        <li class="nav-item disabled">Ustawienia</li>
      </ul>
    </nav>

    <div class="controls">
      <button id="backToMainBtn" class="btn back-cta">PowrÃ³t do strony gÅ‚Ã³wnej</button>
    </div>
  </header>

  <main class="admin-main">
    <section id="adminMachinesSection" class="admin-section">
      <div class="admin-section-header">
        <h2>Modyfikacja maszyn</h2>
        <p class="admin-section-desc">Tutaj moÅ¼esz dodawaÄ‡, usuwaÄ‡ i edytowaÄ‡ kolejnoÅ›Ä‡ maszyn.</p>
      </div>
      <div id="adminMachinesApp" class="admin-section-content"></div>
    </section>

    <section id="adminLoadConfigSection" class="admin-section" style="display:none;">
      <div class="admin-section-header">
        <h2>âš™ï¸ Konfiguracja ObciÄ…Å¼enia Stanowisk</h2>
        <p class="admin-section-desc">Ustaw procentowe wykorzystanie kaÅ¼dego stanowiska dla kaÅ¼dej maszyny.</p>
      </div>
      <div id="loadConfigApp" class="admin-section-content"></div>
    </section>

    <section id="adminEmployeesSection" class="admin-section" style="display:none;">
      <div class="admin-section-header">
        <h2>Lista pracownikÃ³w</h2>
        <p class="admin-section-desc">ZarzÄ…dzaj danymi pracownikÃ³w, ich rolami i uprawnieniami.</p>
      </div>

      <div class="emp-filters">
        <input id="empSearchInput" class="filter-input emp-filter" placeholder="Szukaj po imieniu / nazwisku..." />
        <select id="empSortField" class="filter-select emp-filter">
          <option value="surname">Sortuj: Nazwisko Aâ†’Z</option>
          <option value="firstname">Sortuj: ImiÄ™ Aâ†’Z</option>
        </select>
        <select id="empSortDir" class="filter-select emp-filter">
          <option value="asc">RosnÄ…co â†‘</option>
          <option value="desc">MalejÄ…co â†“</option>
        </select>
        <div id="buMultiFilterWrapper" class="filter-multi-wrapper">
          <button id="buMultiFilterBtn" class="filter-multi-btn">â€” BU â€”</button>
        </div>
        <div id="roleMultiFilterWrapper" class="filter-multi-wrapper">
          <button id="roleMultiFilterBtn" class="filter-multi-btn">â€” Role â€”</button>
        </div>
        <div id="managerMultiFilterWrapper" class="filter-multi-wrapper">
          <button id="managerMultiFilterBtn" class="filter-multi-btn">â€” Kierownik â€”</button>
        </div>
        <div id="permFilterControls" class="perm-filter-controls">
          <select id="permOptions" class="filter-select">
            <option value="">Wybierz uprawnienie</option>
          </select>
          <button id="clearPermsBtn" class="btn small outline">WyczyÅ›Ä‡</button>
        </div>
      </div>

      <div id="permChips" class="perm-chips-container"></div>
      <div id="adminEmployeesApp" class="admin-section-content"></div>
    </section>

    <section id="adminManagersSection" class="admin-section" style="display:none;">
      <div class="admin-section-header">
        <h2>Kierownicy i ich zespoÅ‚y</h2>
        <p class="admin-section-desc">ZarzÄ…dzaj kierownikami i przypisaniem pracownikÃ³w pod kierownikÃ³w.</p>
      </div>

      <div class="managers-controls" style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: space-between; align-items: center;">
        <div style="display: flex; gap: 10px;">
          <button id="addManagerBtn" class="btn" style="background: #28a745;">â• Dodaj kierownika</button>
        </div>
        <div style="display: flex; gap: 10px;">
          <button id="dragDropToggleBtn" class="btn" style="background: #ff9800;">ğŸ”„ PrzesuÅ„ PracownikÃ³w</button>
          <button id="showUnassignedBtn" class="btn" style="background: #667eea;">ğŸ“‹ PokaÅ¼ nieprzypisanych</button>
        </div>
      </div>

      <div id="adminManagersApp" class="admin-section-content"></div>

      <!-- Modal do dodawania/edycji kierownika -->
      <div id="managerFormModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 24px; border-radius: 12px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
          <h2 id="managerFormTitle" style="margin-top: 0; color: #0f1724;">Dodaj kierownika</h2>
          
          <form id="managerForm" style="display: flex; flex-direction: column; gap: 12px;">
            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: #666; margin-bottom: 4px;">Nazwisko *</label>
              <input id="managerSurname" type="text" placeholder="Kowalski" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;" />
            </div>

            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: #666; margin-bottom: 4px;">ImiÄ™ *</label>
              <input id="managerName" type="text" placeholder="Krzysztof" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;" />
            </div>

            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: #666; margin-bottom: 4px;">BU</label>
              <select id="managerBU" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;">
                <option value="">â€” Wybierz BU â€”</option>
                <option value="BU1">BU1</option>
                <option value="BU2">BU2</option>
                <option value="BU3">BU3</option>
                <option value="BU4">BU4</option>
                <option value="Inne">Inne</option>
              </select>
            </div>

            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: #666; margin-bottom: 4px;">Email</label>
              <input id="managerEmail" type="email" placeholder="kierownik@firma.pl" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;" />
            </div>

            <div>
              <label style="display: block; font-size: 12px; font-weight: 600; color: #666; margin-bottom: 4px;">Telefon</label>
              <input id="managerPhone" type="tel" placeholder="123456789" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; box-sizing: border-box;" />
            </div>

            <div style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; background: #f9fafb;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: #333; margin: 0;">
                <input id="managerCanDrive" type="checkbox" style="width: 16px; height: 16px; cursor: pointer; accent-color: #0b74d1;" />
                <span>ğŸš— MoÅ¼e jeÅºdziÄ‡ maszyny</span>
              </label>
            </div>

            <div id="managerPermissionsSection" style="display: none; border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; background: #fafbfc;">
              <label style="display: block; font-size: 12px; font-weight: 600; color: #333; margin-bottom: 10px;">Uprawnienia do maszyn:</label>
              <div id="managerPermissionsGrid" style="display: flex; flex-wrap: wrap; gap: 8px;">
                <!-- Checkboxy bÄ™dÄ… generowane przez JS -->
              </div>
            </div>
          </form>

          <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button id="managerFormDeleteBtn" class="btn" style="flex: 0.5; padding: 10px; background: #b00020; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600; display: none;">ğŸ—‘ï¸ UsuÅ„</button>
            <button id="managerFormCancelBtn" class="btn" style="flex: 1; padding: 10px; background: #999; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;">âœ• Anuluj</button>
            <button id="managerFormSubmitBtn" class="btn" style="flex: 1; padding: 10px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;">âœ… Zapisz</button>
          </div>
        </div>
      </div>

      <!-- Modal do edycji pracownikÃ³w kierownika -->
      <div id="managerEditModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 24px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
          <h2 style="margin-top: 0; color: #0f1724;">Edycja zespoÅ‚u: <span id="managerEditTitle"></span></h2>
          
          <div style="margin-bottom: 16px;">
            <p style="margin: 0 0 12px 0; font-size: 13px; color: #666; font-weight: 600;">Pracownicy przypisani do tego kierownika:</p>
            <div id="managerEmployeesList" style="max-height: 200px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px; padding: 8px;">
            </div>
          </div>

          <div style="margin-bottom: 16px;">
            <p style="margin: 0 0 12px 0; font-size: 13px; color: #666; font-weight: 600;">Dodaj pracownika:</p>
            <div style="display: flex; gap: 8px;">
              <select id="managerEmployeeSelect" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;">
                <option value="">â€” Wybierz pracownika â€”</option>
              </select>
              <button id="managerAddEmployeeBtn" class="btn" style="padding: 8px 12px; font-size: 13px;">Dodaj</button>
            </div>
          </div>

          <div style="display: flex; gap: 8px;">
            <button id="managerEditCloseBtn" class="btn" style="flex: 1; padding: 10px; background: #999; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;">âœ• Zamknij</button>
          </div>
        </div>
      </div>

      <!-- Modal do pokazania nieprzypisanych -->
      <div id="unassignedModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 24px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.2);">
          <h2 style="margin-top: 0; color: #0f1724;">Pracownicy bez przypisanego kierownika</h2>
          
          <div id="unassignedEmployeesList" style="max-height: 400px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px;">
          </div>

          <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button id="unassignedModalCloseBtn" class="btn" style="flex: 1; padding: 10px; background: #999; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 600;">âœ• Zamknij</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- CONFIRM MODAL -->
  <div id="confirmModal" aria-hidden="true" style="display:none;">
    <div class="confirm-box" role="dialog" aria-modal="true">
      <h3>Potwierdzenie</h3>
      <p></p>
      <div class="actions">
        <button class="btn no-btn outline">Nie</button>
        <button class="btn yes-btn danger">Tak</button>
      </div>
    </div>
  </div>

  <!-- NOTIFICATION MODAL -->
  <div id="notificationModal" class="modal" style="display:none;">
    <div class="notification-box">
      <div class="notification-icon" id="notificationIcon">â„¹ï¸</div>
      <h3 id="notificationTitle">Powiadomienie</h3>
      <p id="notificationMessage"></p>
      <button id="notificationOkBtn" class="btn">OK</button>
    </div>
  </div>

  <script src="../config.js"></script>
  <script src="js/admin.js"></script>
</body>
</html>
